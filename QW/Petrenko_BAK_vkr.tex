%
% Шаблон для ВКР бакалавра
%

\documentclass[a4paper,12pt]{article}
\usepackage{vkriate}

% Настройки для окружений с подчеркиваниями для подписей и пр.
\setFRMfontencoding{T2A}
\setFRMdfontencoding{T2A}
% thanks to A.Starikov
\setFRMfontfamily{cmr}
\setFRMdfontfamily{ptm}
\setFRMdfontsize{10pt}

% задает длину поля для подписи на титульной странице
\newFRMfield{xtitlesign}{32mm}

% поле для факультета или кафедры
\newFRMfield{fcath}{65mm}

%имя файла с библиографией в формате BibTex
\addbibresource{rbiblio.bib}


\begin{document}

% счетчики страниц, рисунков, таблиц
\regtotcounter{page}
\regtotcounter{figure}
\regtotcounter{table}

\renewcommand{\refname}{\centerline{СПИСОК ИСПОЛЬЗОВАННЫХ ИСТОЧНИКОВ}} 
\renewcommand{\contentsname}{\centerline{СОДЕРЖАНИЕ}} 
%\renewcommand{\refname}{Список источников}  % По умолчанию "Список литературы" (article)
%\renewcommand{\bibname}{Литература}  % По умолчанию "Литература" (book и report)

% титульная страница
\thispagestyle{empty}
\begin{center} \small
\textbf{МИНИСТЕРСТВО НАУКИ И ВЫСШЕГО ОБРАЗОВАНИЯ\\ РОССИЙСКОЙ ФЕДЕРАЦИИ}\\
ФЕДЕРАЛЬНОЕ ГОСУДАРСТВЕННОЕ АВТОНОМНОЕ ОБРАЗОВАТЕЛЬНОЕ УЧРЕЖДЕНИЕ
ВЫСШЕГО  ОБРАЗОВАНИЯ\\
«Национальный исследовательский ядерный университет «МИФИ»\\
\textbf{Обнинский институт атомной энергетики} – \\
филиал федерального государственного автономного образовательного учреждения высшего\\
образования «Национальный исследовательский ядерный университет «МИФИ»\\
(ИАТЭ НИЯУ МИФИ)
\end{center}
%\vfill
\medskip

% Направление подготовки следует уточнять,
% магистры и бакалавры могут иметь разные наименования
\begin{center}
\begin{tabular}{rl}
Отделение & \useFRMfield{fcath}[\large Интеллектуальные кибернетические системы] \\ 
%Направление подготовки & \useFRMfield{fcath}[\large Информационные системы и технологии] \\ 
\end{tabular} 
\end{center}

\vfill

\large 

\begin{center}
\textbf{\Large Выпускная квалификационная работа --- } \\
\textbf{\Large бакалаврская работа}\\
	
	\medskip

{ \normalsize
по направлению подготовки  \textbf{09.03.02 Информационные  системы и технологии}\\

Направленность (профиль) \textbf{Информационные технологии}
}	
\vfill
\vfill
\medskip

\textbf{\Large 
		Разработка наземной системы позиционирования и навигации микродрона с применением компьютерного зрения
	}
	
\end{center}

\vspace{1cm}

\begin{tabular*}{\textwidth}{p{78mm}p{33mm}p{64mm}}
	Выполнил:\\студент гр. ИС-Б17 & \useFRMfield{xtitlesign} & Петренко В. Ю.\\
	& & \\
	Руководитель ВКР,\\к.т.н., доцент ОИКС & \useFRMfield{xtitlesign} & Мирзеабасов О. А. \\
	& & \\
	
	Нормоконтроль & \useFRMfield{xtitlesign} & Пичугина~И.А. \\
	& & \\
	% Если нужно добавить консультанта - раскомментируйте две строчки ниже
	Консультант ВКР бакалавра\\Инженер ЦОНД  & \useFRMfield{xtitlesign} & Турицын М. И.\\

	& & \\
	Выпускная квалификационная \\ работа допущена к защите & \useFRMfield{xtitlesign} &  \\
	& & \\
	Руководитель\\ образовательной программы \\
	09.03.02 Информационные системы и технологии\\
	канд. тех. наук  & \useFRMfield{xtitlesign} &Мирзеабасов~О.А. \\
	
\end{tabular*}


\vfill
\large

\begin{center}
Обнинск, 2021 г
\end{center}

\onehalfspacing

\pagebreak

% реферат
\thispagestyle{empty}

\section*{\centering РЕФЕРАТ}

\thispagestyle{empty} % страница реферата не нумеруется

Работа \total{page} стр., \total{table} табл., \total{figure} рис., \totalmycitecounts ист. 

БЕСПИЛОТНЫЙ ЛЕТАТЕЛЬНЫЙ АППАРАТ, РОБОТОТЕХНИКА, КВАДРОКОПТЕР, НАЗЕМНАЯ СТАНЦИЯ, ЦИФРОВОЕ ВИДЕОНАБЛЮДЕНИЕ, КОМПЬЮТЕРНОЕ ЗРЕНИЕ, АВТОНОМНЫЙ ПОЛЕТ

Работа посвящена разработке программно-аппаратного комплекса для создания образовательного робототехнического комплекта на основе БПЛА.

Суть работы заключается в разработке робототехнического решения, где координаты дрона вычисляются на наземной станции, исходя из распознанных визуальных маркеров в трансляции видео с борта дрона.

В существующих робототехнических комплектах на базе дрона все вычисления происходят на борту, из-за чего вес БПЛА превышает 250 г и требуется регистрация для осуществления полетов, а также увеличивается стоимость комплекта. Вынося бортовой компьютер в наземную станцию, получается робототехническое решение, позволяющее расширить область применения и спектр выполняемых дроном задач за счет большей производительности, достигаемой наземной станцией. 
% получение кординат коптера относительно маркеров. суть работы удаленно передать на коптер данные о его положении относительно визуальных маркеров

Наземная станция представляет собой совокупность компьютера и программных модулей и является внешней системой позиционирования для дрона. Происходит получение и последующая обработка изображения, где распознаются навигационные маркеры известных размеров и относительно них происходит расчет координат. Результат отправляется на борт квадрокоптера по wifi-соединению.
 
Таким образом, квадрокоптер получает дополнительную систему координат без использования датчиков подобных GPS, а также возможность навигации с использованием компьютерного зрения.

\pagebreak
\thispagestyle{empty}

\section*{\centering ОПРЕДЕЛЕНИЯ}

\thispagestyle{empty} % страница определений не нумеруется

Бод-рейт --- скорость передачи данных с подключенного устройства

Квадрокоптер --- БПЛА мультироторного типа с четырьмя несущими винтами

ПИД регулятор --- алгоритм автоматического управления, применяемый для стабилизации дрона

Релиз --- выпуск окончательной версии программы, готового для использования продукта

Catkin --- система сборки для ROS

OSD --- текст, отображаемый поверх основного изображения, поступающего с видеокамеры на дисплей

Pipeline --- конвейер данных, представляет собой набор элементов обработки данных, соединенных последовательно, где выход одного элемента является входом следующего

UART --- двусторонний порт для обмена данными между полетным контроллером и периферией

\pagebreak
\thispagestyle{empty}

\section*{\centering ОБОЗНАЧЕНИЯ И СОКРАЩЕНИЯ}

БПЛА --- Беспилотный летательный аппарат

ВМГ --- Винто-моторная группа

НИР --- Научно-исследовательская работа

ПАК --- Программно-аппаратный комплекс

ПИД --- Пропорционально-интегрально-дифференциальный

AWG --- American Wire Gauge

BEC --- Battery Eliminator Circuit

CLI --- Command Line Interface

CSI --- Common System Interface

DSI --- Display Serial Interface

ESR --- Equivalent Series Resistance

FPV --- First Person View

GCS --- Ground Control Station

GPS --- Global Positioning System

MAVLink --- Micro Air Vehicle Link

OSD --- On Screen Display

ROS --- Robotic Operating System

RPi --- Raspberry Pi

STEM --- Science, Technology, Engineering and Mathematics

UART --- Universal asynchronous receiver/transmitter


\pagebreak
\tocloftpagestyle{empty}
\tableofcontents

\thispagestyle{empty} % страница реферата не нумеруется
\pagebreak

\setcounter{page}{3}
\section*{\centering ВВЕДЕНИЕ}
\addcontentsline{toc}{section}{ВВЕДЕНИЕ}
\input{intro} % текст введения в файле intro.tex
\pagebreak
\pagebreak
\input{part1}  % первая глава - в файле part1.tex
\pagebreak
\input{part2} % вторая глава - в файле part2.tex
\pagebreak
\input{part3}  % третья глава - в файле part3.tex
\pagebreak
\input{part4} % четвертая глава - в файле part4.tex
\pagebreak

% отступы для глав - корректно ли?
\section*{\centering ЗАКЛЮЧЕНИЕ}
\addcontentsline{toc}{section}{ЗАКЛЮЧЕНИЕ}
В ходе проделанной работы выполнен ряд задач:

	1. Изучена предметная область. Освоены базовые концепты робототехничесного фреймворка ROS, получен опыт работы с протоколом  двусторонней связи MAVLink. Изучены алгоритмы компьютерного зрения на примере ArUco маркеров. Исследованы способы передачи информации между дроном и наземной станцией.
	
	2. Разработан дрон для выполнения поставленной задачи. Проведен анализ прошивок, выбран наиболее подходящий вариант. Произведена настройка системы фильтрации и ПИД алгоритма полетного контроллера. Сконфигурирована прошивка для взаимодействия с системой внешнего визуального позиционирования дрона. Настроен образ бортовой Raspberry Pi для трансляции видео и обмена сообщениями с наземной станцией.
	
	3. Спроектирована наземная станция. Произведена настройка окружения модуля MAVROS для обмена сообщениями телеметрии с дроном по протоколу MAVLink. Собраны и сконфигурированы: драйвер gscam для получения трансляции видео с дрона; пакет aruco\_grid\-board для распознавания навигационных маркеров и получения координат дрона.
	
	4. Протестирована работоспособность прототипов дрона и наземной станции. Выполнена автономная миссия: автоматический запуск моторов, взлет, удержание высоты над полем маркеров и посадка с выключением моторов.


Разработанный программно-аппаратный комплекс позволяет на примере робототехнического комплекта из дрона и наземной станции развивать компетенции в таких областях, как электроника, робототехника, математика, программирование, компьютерное зрение. Идея с выносом бортового компьютера в наземную станцию позволяет уменьшить размер дрона, снизив стоимость компонентов, увеличив безопасность, а также обойти требование по регистрации БПЛА свыше 250 г. В то же время обработка видеопотока на земле расширяет количество и сложность задач, выполняемых дроном, используя подходящий по вычислительной мощности компьютер.

Данный проект был оформлен в виде заявки на программу УМНИК Фонда Содействия Инновациям. Идея успешно прошла предварительный отбор \cite{umnik} и была высоко оценена экспертами на очном этапе. На выполнение проекта был получен грант. На данный момент успешно закрыт первый год выполнения НИР, в течение второго года планируется доработка программной части и создание промышленного образца образовательного робототехнического комплекта на базе БПЛА.
% оформление библиографии - вариант с БД
\pagebreak

\addcontentsline{toc}{section}{СПИСОК ИСПОЛЬЗОВАННЫХ ИСТОЧНИКОВ}
% ВАЖНО: для корректного отображения в списке литературы ссылок на англ.языке в bibtex-описание источника следует добавить поле 
% langid = {english}
\printbibliography

\pagebreak
\section*{ \centering Приложение А} 
\addcontentsline{toc}{section}{Приложение А}

\begin{center}
	Листинг 1 -- Пример кода mavros\_control.py для автономной миссии
\end{center}


\begin{MyCode}

# Control a MAV via mavros
#!/usr/bin/env python

import rospy
import tf
from geometry_msgs.msg import Pose, PoseStamped, Twist, Quaternion
from mavros_msgs.msg import OverrideRCIn
from mavros_msgs.msg import RCIn
from mavros_msgs.srv import CommandBool
from mavros_msgs.srv import SetMode
from mavros_msgs.srv import CommandTOL
import math

pi_2 = math.pi / 2.0

class MavController:
	"""
	A simple object to help interface with mavros
	"""
	
	def __init__(self):
		rospy.init_node("mav_control_node")
		rospy.Subscriber("/mavros/local_position/pose",
				 PoseStamped, self.pose_callback)
		rospy.Subscriber("/mavros/rc/in", RCIn,
				 self.rc_callback)
		
		pLoc = "/mavros/setpoint_position/local"
		cmdVel = "/mavros/setpoint_velocity/cmd_vel_unstamped"
		rc = "/mavros/rc/override"
		
		self.cmd_pos_pub = rospy.Publisher(pLoc, PoseStamped,
				 		  queue_size=1)
		self.cmd_vel_pub = rospy.Publisher(cmdVel, Twist,
						   queue_size=1)
		self.rc_override = rospy.Publisher(rc, OverrideRCIn,
						   queue_size=1)
		
		# mode 0 = STABILIZE
		# mode 4 = GUIDED
		# mode 9 = LAND
		
		mode = '/mavros/set_mode'
		arm = '/mavros/cmd/arming'
		takeoff = '/mavros/cmd/takeoff'
		
		self.mode_service = rospy.ServiceProxy(mode, SetMode)
		self.arm_service = rospy.ServiceProxy(arm,
						      CommandBool)
		self.takeoff_service = rospy.ServiceProxy(takeoff,
						          CommandTOL)
		
		self.rc = RCIn()
		self.pose = Pose()
		self.timestamp = rospy.Time()
		
	def rc_callback(self, data):
		"""
		Keep track of the current manual RC values
		"""
		self.rc = data
		
	def pose_callback(self, data):
		"""
		Handle local position information
		"""
		self.timestamp = data.header.stamp
		self.pose = data.pose
		
	def goto(self, pose):
		"""
		Set the given pose as a the next setpoint by sending
		a SET_POSITION_TARGET_LOCAL_NED message.
		The copter must be in GUIDED mode for this to work.
		"""
		pose_stamped = PoseStamped()
		pose_stamped.header.stamp = self.timestamp
		pose_stamped.pose = pose
		self.cmd_pos_pub.publish(pose_stamped)
		
	def goto_xyz_rpy(self, x, y, z, ro, pi, ya):
		pose = Pose()
		pose.position.x = x
		pose.position.y = y
		pose.position.z = z
		quat = tf.transformations.quaternion_from_euler(ro,pi,
		 					     ya+pi_2)
		pose.orientation.x = quat[0]
		pose.orientation.y = quat[1]
		pose.orientation.z = quat[2]
		pose.orientation.w = quat[3]
		self.goto(pose)
		
	def set_vel(self, vx, vy, vz, avx=0, avy=0, avz=0):
		"""
		Send comand velocities. Must be in GUIDED mode.
		Assumes angular velocities are zero by default.
		"""
		cmd_vel = Twist()
		cmd_vel.linear.x = vx
		cmd_vel.linear.y = vy
		cmd_vel.linear.z = vz
		cmd_vel.angular.x = avx
		cmd_vel.angular.y = avy
		cmd_vel.angular.z = avz
		self.cmd_vel_pub.publish(cmd_vel)
		
	def arm(self):
		"""
		Arm the throttle
		"""
		return self.arm_service(True)
		
	def disarm(self):
		"""
		Disarm the throttle
		"""
		return self.arm_service(False)
		
	def takeoff(self, height=1.0):
		"""
		Arm the throttle, takeoff to a few feet, and
		set to guided mode
		"""
		# Set to stabilize mode for arming
		mode_resp = self.mode_service(custom_mode="4")
		self.arm()
	
		# Takeoff
		takeoff_resp = self.takeoff_service(altitude=height)
		
		#return takeoff_resp
		return mode_resp
		
	def land(self):	
		resp = self.mode_service(custom_mode="9")
		self.disarm()
	
def simple_demo():
	"""
	A simple demonstration of using
	mavros commands to control a UAV.
	"""
	c = MavController()
	rospy.sleep(1)
	alt = 1.0
	print("Takeoff " + str(alt))
	c.takeoff(alt)
	rospy.sleep(2)
	c.goto_xyz_rpy(0,0,alt,0,0,0)
	rospy.sleep(10)
	
	print("Landing")
	c.land()
	
if __name__=="__main__":
	simple_demo()

\end{MyCode}

\end{document}          