
\section{Глава 3. Конфигурация наземной станции}

\subsection{Запуск веб топика на виртуалке}
собираем пакет gscam 
git clone https://github.com/ros-drivers/gscam
сборка:
cmake -DGSTREAMER_VERSION_1_x=On

$ source ~/catkin-ws/devel/setup.bash
В одной вкладке $ roscore (если не запущен)

в roscd gscam $ export GSCAM_CONFIG="udpsrc port=5000 ! gdpdepay ! rtph264depay ! avdec_h264 ! videoconvert"
$ rosrun gscam gscam

На rpi: gst-launch-1.0 rpicamsrc bitrate=1000000 ! 'video/x-h264,width=640,height=480' ! h264parse ! queue ! rtph264pay config-interval=1 pt=96 ! gdppay ! udpsink host=192.168.1.53 port=5000
где =192.168.1.53 - ip ПК

На ПК: $ rosrun web_video_server web_video_server _port:=11315

На localhost:11315 появляется топик image_raw.
Задержка ~200мс, для уменьшения необходимо сменить кодек на *jpeg*

Для взаимодействия с clover необходимо изменить источник камеры в $ nano launch/main_camera.launch

\subsection{Запуск aruco\_gridboard}
tab-1 (запуск нод gscam и aruco\_gridboard по полученному топику): 
export GSCAM_CONFIG="udpsrc port=5000 ! gdpdepay ! rtph264depay ! avdec_h264 ! videoconvert"
roslaunch aruco_gridboard detection_rpicam.launch

tab-2 (запуск окружения маврос): roslaunch mavros apm.launch

tab-3 (The messages SET_GPS_GLOBAL_ORIGIN and a SET_HOME_POSITION are sent with a script before starting to use the system.): rosrun aruco_gridboard set_origin.py

tab-4 (запуск rviz на усмотрение): rosrun rviz rviz -d catkin_ws/src/aruco_gridboard/data/aruco_grid.rviz

запуск rpi
gst-launch-1.0 rpicamsrc bitrate=1000000 ! 'video/x-h264,width=640,height=480' ! h264parse ! queue ! rtph264pay config-interval=1 pt=96 ! gdppay ! udpsink host=192.168.1.53 port=5000

для задержки в 80мс на пк:\\
clever@clever-dev: gst-launch-1.0 udpsrc port=5000 ! "image/jpeg,width=640,height=480,framerate=30/1" ! jpegdec ! videoconvert ! autovideosink sync=false

на рпи:
gst-launch-1.0 rpicamsrc bitrate=10000000 iso=800 shutter-speed=10000 contrast=50 ! "image/jpeg,width=640,height=480,framerate=30/1" ! udpsink host=192.168.1.53 port=5000

export GSCAM_CONFIG="udpsrc port=5000 ! "image/jpeg,width=640,height=480,framerate=30/1" ! jpegdec ! videoconvert"
\$ rostopic echo /mavros/vision_pose/pose

-----
Собрали через каткин драйвер gscam, запустили roscore, осталось изменить лаунч и получить поток.
Для создания топиков необхходимо настроить маврос.

В /opt/ros/melodic/share/mavros/launch/apm.launch меняется параметр fcu\_url для общения с телеметрией по порту полетника с помощью ser2net proxy:
<arg name="fcu\_url" default="tcp://192.168.10.16:2000" />

\$ cd ~/catkin\_ws/src
\$ git clone https://github.com/jokla/aruco\_gridboard.git
\$ cd ..
\$ catkin\_make
\$ source devel/setup.bash
catkin\_make --only-pkg-with-deps <target\_package>

%https://code.google.com/archive/p/brown-ros-pkg/wikis/Quick_start_rosbridge_and_ROS.wiki дл роскор, жскам
